---
import { useStoryblokApi } from '@storyblok/astro';
import Layout from '@layout';

interface Noticia {
  Titulo: string;
  Cuerpo: any;
  Autor: any[];
  Fecha_publicacion: string;
  uuid: string;
  content: any;
  slug: string;
}

// Obtener todas las noticias desde Storyblok
const storyblokApi = useStoryblokApi();
let noticias = [];

try {
  const { data } = await storyblokApi.get('cdn/stories/', {
    version: 'draft',  // Cambia a 'published' en producción
    starts_with: 'noticias/', // Solo obtener historias dentro de "noticias"
    sort_by: 'created_at:desc' // Ordenar por fecha de creación
  });
  noticias = data.stories;
} catch (error) {
  console.error("Error fetching Storyblok data:", error);
}

---

<Layout title="Noticias" description="Últimas noticias de la asociación">
  <main class="py-10">
    <h1 class="text-4xl font-bold mb-6">Últimas Noticias</h1>

    <!-- Listar todas las noticias -->
    <ul class="list-none space-y-6">
      {noticias.length > 0 ? (
        noticias.map((noticia: Noticia) => (
          <li id={noticia.uuid} class="border-b pb-4">
            <a href={`/noticias/${noticia.slug}`} class="text-2xl font-semibold text-blue-600 hover:underline">
              {noticia.content.titulo}
            </a>
            <p class="text-gray-500">
              Publicado el {new Date(noticia.content.Fecha_publicacion).toLocaleDateString('es-MX', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
              })}
            </p>
          </li>
        ))
      ) : (
        <p>No hay noticias disponibles en este momento.</p>
      )}
    </ul>
  </main>
</Layout>
